# --- VFR Technical Name Star Query Execution ---
technical_name_star = f"""
SELECT 
  tfs_technical_names_merged_3.`shpmt_id`, 
  tfs_technical_names_merged_3.`tfs_origin_zone_name`, 
  tfs_technical_names_merged_3.`dest_zone_val`, 
  tfs_technical_names_merged_3.`ship_to_party_desc`, 
  tfs_technical_names_merged_3.`customer_desc`, 
  tfs_technical_names_merged_3.`carr_desc`, 
  tfs_technical_names_merged_3.`voucher_type_code`, 
  tfs_technical_names_merged_3.`tdcval_code`, 
  tfs_technical_names_merged_3.`freight_cost_charge_code`, 
  tfs_technical_names_merged_3.`tms_freight_charge_desc`, 
  tfs_technical_names_merged_3.`freight_charge2_desc`, 
  tfs_technical_names_merged_3.`flow_reason_val`, 
  tfs_technical_names_merged_3.`acsrl_reason_name`, 
  CAST(tfs_technical_names_merged_3.`total_trans_cost_usd_amt` AS STRING) AS `total_trans_cost_usd_amt`, 
  CAST(tfs_technical_names_merged_3.`adjmt_cost_usd_amt` AS STRING) AS `adjmt_cost_usd_amt`,
  CAST(tfs_technical_names_merged_3.`contract_cost_usd_amt` AS STRING) AS `contract_cost_usd_amt`,
  CAST(tfs_technical_names_merged_3.`post_charge_cost_usd_amt` AS STRING) AS `post_charge_cost_usd_amt`,
  CAST(tfs_technical_names_merged_3.`spot_cost_usd_amt` AS STRING) AS `spot_cost_usd_amt`,
  CAST(tfs_technical_names_merged_3.`misc_cost_usd_amt` AS STRING) AS `misc_cost_usd_amt`,
  CAST(tfs_technical_names_merged_3.`weight_per_load_qty` AS STRING) AS `weight_per_load_qty`,
  CAST(tfs_technical_names_merged_3.`volume_per_load_qty` AS STRING) AS `volume_per_load_qty`,
  CAST(tfs_technical_names_merged_3.`floor_position_as_ship_cnt` AS STRING) AS `floor_position_as_ship_cnt`,
  CAST(tfs_technical_names_merged_3.`theortc_pallet_cnt` AS STRING) AS `theortc_pallet_cnt`,
  tfs_technical_names_merged_3.`actual_gi_date`, 
  tfs_technical_names_merged_3.`charge_code`, 
  tfs_technical_names_merged_3.`dlvry_id`, 
  tfs_technical_names_merged_3.`profit_center_code`, 
  tfs_technical_names_merged_3.`cntrlng_area_code`, 
  CAST(tfs_technical_names_merged_3.`distance_qty` AS STRING) AS `distance_qty`, 
  tfs_technical_names_merged_3.`distance_uom`, 
  CAST(tfs_technical_names_merged_3.`total_weight_ship_qty` AS STRING) AS `total_weight_ship_qty`,
  tfs_technical_names_merged_3.`weight_uom`, 
  CAST(tfs_technical_names_merged_3.`total_volume_ship_qty` AS STRING) AS `total_volume_ship_qty`,
  tfs_technical_names_merged_3.`volume_uom`, 
  tfs_technical_names_merged_3.`currency_code`, 
  tfs_technical_names_merged_3.`su_per_load_qty`, 
  tfs_technical_names_merged_3.`ship_from_region_code`, 
  tfs_technical_names_merged_3.`ship_to_region_desc`, 
  tfs_technical_names_merged_3.`country_to_code`, 
  680_tdcval_hierarchy.`categ_name` AS `categ_code`, 
  680_tdcval_hierarchy.`sector_name` AS `sector_desc`, 
  680_tdcval_hierarchy.`subsector_name` AS `subsector_desc`, 
  tfs_technical_names_merged_3.`voucher_status_code`, 
  tfs_technical_names_merged_3.`voucher_ref_num`, 
  tfs_technical_names_merged_3.`country_from_desc_name`, 
  tfs_technical_names_merged_3.`country_to_desc_name`, 
  tfs_technical_names_merged_3.`equip_mode_desc`, 
  tfs_technical_names_merged_3.`ship_from_region_desc`, 
  tfs_technical_names_merged_3.`table_uom`, 
  tfs_technical_names_merged_3.`origin_desc`, 
  tfs_technical_names_merged_3.`cost_center_code`, 
  tfs_technical_names_merged_3.`voucher_id`, 
  tfs_technical_names_merged_3.`multi_stop_flag`, 
  tfs_technical_names_merged_3.`temp_protect_code`, 
  tfs_technical_names_merged_3.`spot_flag_val`, 
  tfs_technical_names_merged_3.`gbu_code`, 
  tfs_technical_names_merged_3.`goods_receipt_post_date`, 
  tfs_technical_names_merged_3.`create_tmstp`, 
  tfs_technical_names_merged_3.`create_date`, 
  tfs_technical_names_merged_3.`na_target_country_code`, 
  tfs_technical_names_merged_3.`ship_to_party_num`, 
  tfs_technical_names_merged_3.`ship_point_code`, 
  tfs_technical_names_merged_3.`trans_plan_point_code`, 
  tfs_technical_names_merged_3.`equip_mode_code`, 
  tfs_technical_names_merged_3.`trans_equip_type_code`, 
  tfs_technical_names_merged_3.`freight_type_customer_interplant_ind_code`, 
  tfs_technical_names_merged_3.`country_from_code`, 
  tfs_technical_names_merged_3.`tms_charge_lvl_desc`, 
  tfs_technical_names_merged_3.`tms_charge_kind_desc`, 
  tfs_technical_names_merged_3.`tms_interface_reason_cost_code`, 
  CAST(tfs_technical_names_merged_3.`chart_account_num` AS STRING) AS `chart_account_num`,
  tfs_technical_names_merged_3.`step_factor`, 
  tfs_technical_names_merged_3.`company_code`, 
  680_tdcval_hierarchy.`tdcval_name` AS `tdcval_desc`, 
  tfs_technical_names_merged_3.`freight_bill_create_date`, 
  tfs_technical_names_merged_3.`dlvry_item_cnt`, 
  tfs_technical_names_merged_3.`carr_country_name`, 
  tfs_technical_names_merged_3.`carr_country_code`, 
  IF(tfs_technical_names_merged_3.`carr_country_name` = 'US', substr(tfs_technical_names_merged_3.`carr_postal_code`, 1, 5), tfs_technical_names_merged_3.`carr_postal_code`) AS `carr_postal_code`, 
  tfs_technical_names_merged_3.`ship_to_postal_code`, 
  tfs_technical_names_merged_3.`ship_to_state_code`, 
  tfs_technical_names_merged_3.`ship_to_state_name`, 
  tfs_technical_names_merged_3.`minority_ind_val`, 
  IF(tfs_technical_names_merged_3.actual_gi_date < '2018-06-01', tfs_technical_names_merged_3.dest_zone_val, tfs_technical_names_merged_3.dest_zone_go_name) AS dest_zone_go_name, 
  IF(tfs_technical_names_merged_3.actual_gi_date < '2018-06-01', tfs_technical_names_merged_3.tfs_origin_zone_name, tfs_technical_names_merged_3.origin_zone_name) AS origin_zone_name, 
  tfs_technical_names_merged_3.`dest_loc_code`, 
  tfs_technical_names_merged_3.`charge_detail_id`, 
  tfs_technical_names_merged_3.`material_doc_num`, 
  tfs_technical_names_merged_3.`purchase_doc_num`, 
  CAST(tfs_technical_names_merged_3.`charge_kind_code` AS STRING) AS `charge_kind_code`,
  CAST(tfs_technical_names_merged_3.`charge_lvl` AS STRING) AS `charge_lvl`,
  tfs_technical_names_merged_3.`billing_proposal_num`, 
  tfs_technical_names_merged_3.`gl_account_num`, 
  CAST(tfs_technical_names_merged_3.`step_per_load2_rate` AS STRING) AS `step_per_load2_rate`,
  CAST(tfs_technical_names_merged_3.`step_per_load_rate` AS STRING) AS `step_per_load_rate`,
  CAST(tfs_technical_names_merged_3.`total_trans_cost_local_currency_amt` AS STRING) AS `total_trans_cost_local_currency_amt`,
  CAST(tfs_technical_names_merged_3.`cost_on_step_local_currency_amt` AS STRING) AS `cost_on_step_local_currency_amt`,
  CAST(tfs_technical_names_merged_3.`adjmt_cost_local_currency_amt` AS STRING) AS `adjmt_cost_local_currency_amt`,
  CAST(tfs_technical_names_merged_3.`contract_cost_local_currency_amt` AS STRING) AS `contract_cost_local_currency_amt`,
  CAST(tfs_technical_names_merged_3.`post_charge_cost_local_currency_amt` AS STRING) AS `post_charge_cost_local_currency_amt`,
  CAST(tfs_technical_names_merged_3.`spot_cost_local_currency_amt` AS STRING) AS `spot_cost_local_currency_amt`,
  CAST(tfs_technical_names_merged_3.`misc_cost_local_currency_amt` AS STRING) AS `misc_cost_local_currency_amt`,
  tfs_technical_names_merged_3.`tfts_load_date`, 
  tfs_technical_names_merged_3.`load_from_file_url`, 
  tfs_technical_names_merged_3.`carr_id`, 
  tfs_technical_names_merged_3.`row_modify_tmstp`, 
  tfs_technical_names_merged_3.`freight_auction_val`, 
  tfs_technical_names_merged_3.`hist_data_structure_flag`, 
  tfs_technical_names_merged_3.`origin_longitude_val`, 
  tfs_technical_names_merged_3.`origin_latitude_val`, 
  tfs_technical_names_merged_3.`dest_longitude_val`, 
  tfs_technical_names_merged_3.`dest_latitude_val`, 
  tfs_technical_names_merged_3.`dest_postal_code`, 
  tfs_technical_names_merged_3.`five_digit_lane_name`, 
  tfs_technical_names_merged_3.`region_2_3_digit_lane_name`, 
  tfs_technical_names_merged_3.`customer_specific_lane_name`, 
  tfs_technical_names_merged_3.`customer1_lvl`, 
  tfs_technical_names_merged_3.`customer2_lvl`, 
  tfs_technical_names_merged_3.`customer3_lvl`, 
  tfs_technical_names_merged_3.`customer4_lvl`, 
  tfs_technical_names_merged_3.`customer5_lvl`, 
  tfs_technical_names_merged_3.`customer6_lvl`, 
  tfs_technical_names_merged_3.`customer7_lvl`, 
  tfs_technical_names_merged_3.`customer8_lvl`, 
  tfs_technical_names_merged_3.`customer9_lvl`, 
  tfs_technical_names_merged_3.`customer10_lvl`, 
  tfs_technical_names_merged_3.`customer11_lvl`, 
  tfs_technical_names_merged_3.`customer12_lvl`, 
  tfs_technical_names_merged_3.`carr_and_source_service_val`, 
  CAST(tfs_technical_names_merged_3.`accrual_cost_amt` AS STRING) AS `accrual_cost_amt`,
  CAST(tfs_technical_names_merged_3.`line_haul_cost_amt` AS STRING) AS `line_haul_cost_amt`,
  CAST(tfs_technical_names_merged_3.`fuel_cost_amt` AS STRING) AS `fuel_cost_amt`,
  CAST(tfs_technical_names_merged_3.`other_contract_cost_amt` AS STRING) AS `other_contract_cost_amt`,
  CAST(tfs_technical_names_merged_3.`frcst_cost_amt` AS STRING) AS `frcst_cost_amt`,
  tfs_technical_names_merged_3.`ave_total_trans_cost_per_pallet_amt`, 
  CAST(tfs_technical_names_merged_3.`total_trans_cost_per_lb_amt` AS STRING) AS `total_trans_cost_per_lb_amt`,
  CAST(tfs_technical_names_merged_3.`total_trans_cost_per_cubic_feet_volume_amt` AS STRING) AS `total_trans_cost_per_cubic_feet_volume_amt`,
  CAST(tfs_technical_names_merged_3.`total_trans_cost_per_mile_amt` AS STRING) AS `total_trans_cost_per_mile_amt`,
  CAST(tfs_technical_names_merged_3.`total_trans_cost_per_su_amt` AS STRING) AS `total_trans_cost_per_su_amt`,
  tfs_technical_names_merged_3.`accrued_contract_cost_amt`, 
  tfs_technical_names_merged_3.`accrued_line_haul_cost_amt`, 
  tfs_technical_names_merged_3.`accrued_fuel_cost_amt`, 
  tfs_technical_names_merged_3.`accrued_other_contract_cost_amt`, 
  tfs_technical_names_merged_3.`accrued_spot_charge_rate`, 
  CAST(tfs_technical_names_merged_3.`post_charge_cost_amt` AS STRING) AS `post_charge_cost_amt`,
  CAST(tfs_technical_names_merged_3.`misc_cost_amt` AS STRING) AS `misc_cost_amt`,
  CAST(tfs_technical_names_merged_3.`contract_cost_amt` AS STRING) AS `contract_cost_amt`,
  CAST(tfs_technical_names_merged_3.`multi_tdcval_code` AS STRING) AS `multi_tdcval_code`,
  tfs_technical_names_merged_3.`min_charge_amt`, 
  tfs_technical_names_merged_3.`charge_reason_freight_concat_name`, 
  tfs_technical_names_merged_3.`avoidbl_touch_val`, 
  tfs_technical_names_merged_3.`opertn_freight_type_code`, 
  tfs_technical_names_merged_3.`truckload_vs_intermodal_val`, 
  CAST(tfs_technical_names_merged_3.`pgp_flag` AS STRING) AS `pgp_flag`,
  tfs_technical_names_merged_3.`freight_type_val`, 
  tfs_technical_names_merged_3.`first_tender_carr_name`, 
  tfs_technical_names_merged_3.`service_tms_code`, 
  CAST(tfs_technical_names_merged_3.`distance_per_load_qty` AS STRING) AS `distance_per_load_qty`,
  tfs_technical_names_merged_3.`hist_data`, 
  tfs_technical_names_merged_3.`first_tender_carr_id`, 
  tfs_technical_names_merged_3.`first_tender_carr_desc`, 
  tfs_technical_names_merged_3.`first_tender_carr_tms_service_code`, 
  CAST(tfs_technical_names_merged_3.`first_tender_carr_award_qty` AS STRING) AS `first_tender_carr_award_qty`,
  CAST(tfs_technical_names_merged_3.`first_tender_carr_rate` AS STRING) AS `first_tender_carr_rate`,
  CAST(wal.weighted_average_rate AS STRING) AS `weight_avg_rate`,
  CAST(tfs_technical_names_merged_3.`primary_carr_flag` AS STRING) AS `primary_carr_flag`,
  CAST(tfs_technical_names_merged_3.`accrual_cost_usd_amt` AS STRING) AS `accrual_cost_usd_amt`,
  CAST(tfs_technical_names_merged_3.`total_trans_cost_usd_include_accrual_amt` AS STRING) AS `total_trans_cost_usd_include_accrual_amt`,
  tfs_technical_names_merged_3.`dest_ship_from_code` 
FROM 
  tfs_technical_names_merged_3 
  LEFT OUTER JOIN weighted_awards_for_lanes2_new_data AS wal ON tfs_technical_names_merged_3.`shpmt_id` = wal.`shpmt_id` 
  AND COALESCE(tfs_technical_names_merged_3.`tfs_origin_zone_name`, 'XXX') = COALESCE(wal.`tfs_origin_zone_name`, 'XXX') 
  AND tfs_technical_names_merged_3.`dest_ship_from_code` = wal.`dest_ship_from_code` 
  AND COALESCE(tfs_technical_names_merged_3.`dest_postal_code`, 'XXX') = COALESCE(wal.`dest_postal_code`, 'XXX') 
  AND tfs_technical_names_merged_3.`actual_gi_date` = wal.`actual_gi_date` 
  AND tfs_technical_names_merged_3.`service_tms_code` not like 'LTL%' 
  AND tfs_technical_names_merged_3.`country_to_code` != 'MX' 
  LEFT OUTER JOIN {source_db_name}.tdcval_hierarchy680_lkp_vw AS 680_t
